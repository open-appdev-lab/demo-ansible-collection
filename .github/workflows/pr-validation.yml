name: PR Validation

on:
  pull_request:
    branches: [ "main" ]
  pull_request_target:
    types: [opened, synchronize, reopened, edited]
    branches: [ "main" ]
  merge_group:
    types: [checks_requested]

permissions:
  contents: read
  pull-requests: write

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR title
        shell: bash
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          REGEXP="^(feat|fix|docs|style|refactor|perf|test|chore|revert|ci|build)(\(.+\))?!?: .+$"
          MAX_LENGTH=72
          if [[ ! "$PR_TITLE" =~ $REGEXP ]]; then
            echo "❌ ERROR: Invalid PR title format. Use type(scope): description"; exit 1
          fi
          if [ ${#PR_TITLE} -gt $MAX_LENGTH ]; then
            echo "❌ ERROR: PR title too long (${#PR_TITLE}/$MAX_LENGTH)"; exit 1
          fi
          echo "✅ PR title is valid!"
